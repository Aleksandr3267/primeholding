import{r as _,i as y,k as g,w as v,x as E,j as e,C as r,m as S,y as P}from"./index-0b81dd7c.js";import{c as B,a as c,b as V,d as $}from"./index.esm-a5665108.js";import{U as q}from"./Uploader-8928e4d9.js";const w=B().shape({clientName:c().required("Поле обязательно для заполнения"),clientPhone:c().required("Поле обязательно для заполнения").matches(/^[\d+]+$/,"Телефон должен содержать только цифры"),date:V().required("Поле обязательно для заполнения").typeError("Поле обязательно для заполнения"),price:$().required("Поле обязательно для заполнения").typeError("Поле обязательно для заполнения"),contractNumber:c().required("Поле обязательно для заполнения"),comment:c()});function I({setUpdateStatus:o}){const[m,i]=_.useState({}),d=y(),u=g(v),{handleSubmit:h,control:t,formState:p,setError:x,reset:j}=E(),{errors:s}=p,f=async a=>{try{await w.validate(a,{abortEarly:!1});const n={apartment:u,clientName:a.clientName,clientPhone:a.clientPhone,contractNumber:a.contractNumber,contractDocument:m,purchase:{date:new Date(a.date),price:parseInt(a.price,10)},comment:a.comment};d(P(n)).unwrap().then(l=>{(l==null?void 0:l.status)===200&&(N(),i({}),j(),b())})}catch(n){n.inner.forEach(l=>{x(l.path,{type:"manual",message:l.message})})}},b=()=>{const a=document.getElementById("close-form-btn");a&&a.click()},N=()=>{o("3")};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"modal fade modal-for-admin",id:"formBuying",tabIndex:-1,"aria-labelledby":"formBuying","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"modal-body modal-call__body",children:[e.jsxs("form",{className:"modal-call__form",onSubmit:h(f),children:[e.jsx("h4",{className:"modal-call__title",children:"Покупка"}),e.jsxs("div",{className:"modal-for-admin__forms",children:[e.jsxs("div",{className:"modal-call__side",children:[e.jsx("p",{className:"modal-for-admin__title-side",children:"Данные клиента"}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"clientName",control:t,defaultValue:"",render:({field:a})=>e.jsx("input",{placeholder:"ФИО клиента*",...a})}),s.clientName&&e.jsx("p",{children:s.clientName.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"clientPhone",control:t,defaultValue:"",render:({field:a})=>e.jsx("input",{placeholder:"Телефон клиента*",...a})}),s.clientPhone&&e.jsx("p",{children:s.clientPhone.message})]})]}),e.jsxs("div",{className:"modal-call__side",children:[e.jsx("p",{className:"modal-for-admin__title-side",children:"Параметры"}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"date",control:t,defaultValue:"",render:({field:a})=>e.jsx("input",{placeholder:"Дата покупки*",...a,type:"date",max:"2099-12-31"})}),s.date&&e.jsx("p",{children:s.date.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"price",control:t,defaultValue:"",render:({field:a})=>e.jsx("input",{placeholder:"Сумма",...a,type:"number"})}),s.price&&e.jsx("p",{children:s.price.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"contractNumber",control:t,defaultValue:"",render:({field:a})=>e.jsx("input",{placeholder:"Номер договора*",...a,type:"text"})}),s.contractNumber&&e.jsx("p",{children:s.contractNumber.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(r,{name:"comment",control:t,defaultValue:"",render:({field:a})=>e.jsx("textarea",{placeholder:"Комментарий",...a})}),s.comment&&e.jsx("p",{children:s.comment.message})]}),e.jsxs("div",{className:"modal-admin__controls",children:[e.jsx(q,{file:m,setFile:i}),e.jsx("button",{type:"submit",className:"form__btn-submit link-brown",children:"Сохранить"}),e.jsx("button",{type:"button",className:"form__btn-undoing","data-bs-dismiss":"modal","aria-label":"Закрыть",children:"Отмена"})]})]})]})]}),e.jsx("button",{type:"button",id:"close-form-btn",className:"modal-call__btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть",value:"Send",children:e.jsx("img",{src:S,alt:"Закрыть"})})]})})})})})}export{I as default};
