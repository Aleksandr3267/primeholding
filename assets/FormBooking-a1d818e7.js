import{i as F,k as M,w as $,x as B,r as i,j as e,C as c,m as V,z as I}from"./index-254d410c.js";import{c as q,a as m,d as A}from"./index.esm-bf267ef4.js";import{e as j}from"./index-b3d2271c.js";import{U as L}from"./Uploader-b8843ac3.js";const R=q().shape({clientName:m().required("Поле обязательно для заполнения"),clientPhone:m().required("Поле обязательно для заполнения").matches(/^[\d+]+$/,"Телефон должен содержать только цифры"),deposit:A().required("Поле обязательно для заполнения").typeError("Поле обязательно для заполнения"),contractNumber:m().required("Поле обязательно для заполнения"),comment:m()});function H({setUpdateStatus:b}){const f=F(),D=M($),{handleSubmit:N,control:r,formState:g,setError:v,setValue:d,reset:_}=B(),{errors:a}=g,[u,h]=i.useState({}),[s,k]=i.useState(new Date),[n,y]=i.useState(new Date(new Date().setMonth(new Date().getMonth()+1))),[S,x]=i.useState(!1),w=async t=>{try{await R.validate(t,{abortEarly:!1});const l={apartment:D,clientName:t.clientName,clientPhone:t.clientPhone,contractNumber:t.contractNumber,contractDocument:u,rent:{startDate:new Date(s),endDate:new Date(n),deposit:parseInt(t.deposit,10)},comment:t.comment};f(I(l)).unwrap().then(o=>{(o==null?void 0:o.status)===200&&(P(),h({}),_(),E()),console.log(o)})}catch(l){l.inner.forEach(o=>{v(o.path,{type:"manual",message:o.message})})}},E=()=>{const t=document.getElementById("close-rent-form-btn");t&&t.click()},C=()=>{d("bookingDates.fromDate",s),d("bookingDates.toDate",n),x(!1)},p=t=>t.toLocaleDateString(),P=()=>{b("2")};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"modal fade modal-for-admin",id:"formBooking",tabIndex:-1,"aria-labelledby":"formBooking","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"modal-body modal-call__body",children:[e.jsxs("form",{className:"modal-call__form",onSubmit:N(w),children:[e.jsx("h4",{className:"modal-call__title",children:"Бронь"}),e.jsxs("div",{className:"modal-for-admin__forms",children:[e.jsxs("div",{className:"modal-call__side",children:[e.jsx("p",{className:"modal-for-admin__title-side",children:"Данные клиента"}),e.jsxs("div",{className:"form-item",children:[e.jsx(c,{name:"clientName",control:r,defaultValue:"",render:({field:t})=>e.jsx("input",{placeholder:"ФИО клиента*",...t})}),a.clientName&&e.jsx("p",{children:a.clientName.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(c,{name:"clientPhone",control:r,defaultValue:"",render:({field:t})=>e.jsx("input",{pattern:"[0-9]*",placeholder:"Телефон клиента*",maxLength:"20",...t,onInput:l=>{l.target.value=l.target.value.replace(/[^0-9]/g,"")}})}),a.clientPhone&&e.jsx("p",{children:a.clientPhone.message})]})]}),e.jsxs("div",{className:"modal-call__side",children:[e.jsx("p",{className:"modal-for-admin__title-side",children:"Параметры"}),e.jsxs("div",{className:"form-item",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"Срок брони*",value:s&&n?`${p(s)} - ${p(n)}`:"",onClick:()=>x(!0),readOnly:!0}),a.bookingDates&&e.jsxs("p",{children:[a.bookingDates.fromDate&&a.bookingDates.fromDate.message,e.jsx("br",{}),a.bookingDates.toDate&&a.bookingDates.toDate.message]})]}),S&&e.jsxs("div",{className:"admin-term-form",children:[e.jsxs("div",{className:"admin-term-blocks",children:[e.jsxs("div",{className:"admin-term-block",children:[e.jsx("p",{children:"От:"}),e.jsx(j,{selected:s,onChange:t=>k(t),selectsStart:!0,startDate:s,endDate:n,minDate:new Date,dateFormat:"dd.MM.yy"})]}),e.jsxs("div",{className:"admin-term-block",children:[e.jsx("p",{children:"До:"}),e.jsx(j,{selected:n,onChange:t=>y(t),selectsEnd:!0,startDate:s,endDate:n,minDate:s||new Date,dateFormat:"dd.MM.yy"})]})]}),e.jsx("button",{className:"admin-term-button",onClick:C,children:"Применить"})]})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(c,{name:"deposit",control:r,defaultValue:"",render:({field:t})=>e.jsx("input",{placeholder:"Задаток(До 7 дней без задатка)",...t,type:"number"})}),a.deposit&&e.jsx("p",{children:a.deposit.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(c,{name:"contractNumber",control:r,defaultValue:"",render:({field:t})=>e.jsx("input",{placeholder:"Номер договора*",...t,type:"text"})}),a.contractNumber&&e.jsx("p",{children:a.contractNumber.message})]}),e.jsxs("div",{className:"form-item",children:[e.jsx(c,{name:"comment",control:r,defaultValue:"",render:({field:t})=>e.jsx("textarea",{placeholder:"Комментарий",...t})}),a.comment&&e.jsx("p",{children:a.comment.message})]}),e.jsxs("div",{className:"modal-admin__controls",children:[e.jsx(L,{file:u,setFile:h}),e.jsx("button",{type:"submit",className:"form__btn-submit link-brown",children:"Сохранить"}),e.jsx("button",{type:"button",className:"form__btn-undoing","data-bs-dismiss":"modal","aria-label":"Закрыть",children:"Отмена"})]})]})]})]}),e.jsx("button",{type:"button",className:"modal-call__btn-close",id:"close-rent-form-btn","data-bs-dismiss":"modal","aria-label":"Закрыть",value:"Send",children:e.jsx("img",{src:V,alt:"Закрыть"})})]})})})})})}export{H as default};
